{% extends 'base.html' %}
{% block content %}

<div class="container mt-6">
  {% if user.is_authenticated %}
    <h2 class="text-center">Welcome, {{ user.username }}</h2>
  {% endif %}
  <h6>
    Take your daily Water Intake & Stay Hydrated 
  </h6>
  <div class="row">
    <div class="col-md-6">
      <div class="card shadow-sm p-4">
        <h5 class="mb-3 text-center">ðŸ’§ Add Water Intake</h5>
        
        <form method="POST" action="{% url 'add_water_intake' %}">
          {% csrf_token %}
          
          <div class="mb-3">
            {{ form.amount.label_tag }}
            {{ form.amount }}
            {% if form.amount.errors %}
              <div class="text-danger small">{{ form.amount.errors }}</div>
            {% endif %}
          </div>

          <button type="submit" class="btn btn-success w-20">Add Intake</button>
        </form>

        
        <hr>
        <p>Water Consumed: <span style="color: green;">{{ total_intake }} ml</span> / <span style="color: blue;">{{ daily_goal }} ml</span></p>
        <p>Remaining: <span style="color: orange;">{{ remaining }} ml</span></p>

        <div class="d-flex justify-content-between mt-3">
          <a href="{% url 'weekly_history' %}" class="btn btn-outline-secondary btn-sm">ðŸ“… Weekly History</a>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body text-center">
          <h4 class="card-title">Today's Water Intake</h4>

          <div id="chart-container" class="text-center"></div>

          <p class="mt-3">
            You've consumed {{ total_intake }} ml out of {{ daily_goal }} ml today.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('chart-container').innerHTML = '<canvas id="progressChart" width="200" height="200"></canvas>';

  const ctx = document.getElementById('progressChart').getContext('2d');
  const total = parseInt("{{ total_intake|default:0 }}");
  const goal = parseInt("{{ daily_goal|default:0 }}");

  const remaining = Math.max(goal - total, 0);

  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['Consumed', 'Remaining'],
      datasets: [{
        data: [total, remaining],
        backgroundColor: ['#0d6efd', '#e9ecef']
      }]
    },
    options: {
      plugins: {
        title: {
          display: true,
          text: 'Hydration Progress'
        },
        legend: {
          position: 'bottom'
        }
      }
    }
  });
</script>

{% endblock %}
